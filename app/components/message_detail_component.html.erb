<div class="h-full flex flex-col">
  <%# Action bar %>
  <div class="flex items-center gap-2 px-6 py-3 border-b border-gray-200">
    <%= button_to move_message_path(@message, label: "archive"), method: :patch,
      class: "inline-flex items-center gap-1.5 px-3 py-1.5 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-md",
      data: { turbo_stream: true } do %>
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
        <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z" />
      </svg>
      Archive
    <% end %>

    <%= button_to move_message_path(@message, label: "trash"), method: :patch,
      class: "inline-flex items-center gap-1.5 px-3 py-1.5 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-md",
      data: { turbo_stream: true } do %>
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
        <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
      </svg>
      Trash
    <% end %>

    <%= button_to toggle_read_message_path(@message), method: :patch,
      class: "inline-flex items-center gap-1.5 px-3 py-1.5 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-md",
      data: { turbo_stream: true } do %>
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
        <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" />
      </svg>
      Mark unread
    <% end %>
  </div>

  <%# Message header %>
  <div class="px-6 py-4 border-b border-gray-200">
    <h2 class="text-xl font-semibold text-gray-900 mb-4"><%= @message.subject %></h2>
    <div class="flex items-start gap-4">
      <%= render AvatarComponent.new(contact: @message.sender, size: :lg) %>
      <div class="flex-1">
        <div class="flex items-center justify-between">
          <div>
            <span class="font-semibold text-gray-900"><%= @message.sender.name %></span>
            <span class="text-sm text-gray-500 ml-2">&lt;<%= @message.sender.email %>&gt;</span>
          </div>
          <span class="text-sm text-gray-500"><%= time_ago_in_words(@message.created_at) %> ago</span>
        </div>
        <p class="text-sm text-gray-500 mt-0.5">To: <%= @message.recipient.name %></p>
      </div>
    </div>
  </div>

  <%# Message body %>
  <div class="flex-1 px-6 py-4 overflow-y-auto">
    <div class="prose max-w-none">
      <p style="white-space: pre-wrap;" class="text-gray-800"><%= @message.body %></p>
    </div>
  </div>

  <%# Reply section %>
  <div class="px-6 py-4 border-t border-gray-200">
    <%= render ButtonComponent.new(
      variant: :primary,
      data: {
        action: "click->compose#reply",
        compose_message_id_param: @message.id,
        compose_sender_name_param: @message.sender.name,
        compose_subject_param: @message.subject
      }
    ) do %>
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 inline">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3" />
      </svg>
      Reply
    <% end %>
  </div>
</div>
